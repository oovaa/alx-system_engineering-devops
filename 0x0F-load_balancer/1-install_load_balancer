#!/usr/bin/env bash

# install haproxy
sudo apt update
sudo apt install haproxy

conffile='/etc/haproxy/haproxy.cfg'

conf="
defaults
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http_front
   bind *:80
   stats uri /haproxy?stats
   default_backend http_back

backend http_back
   balance roundrobin
   server 513331-web-01 54.165.78.43:80 check
   server 513331-web-02 54.84.65.46:80 check"

echo "$conf" >$conffile

# Make sure that HAproxy can be managed via an init script
sudo systemctl enable haproxy

sudo service haproxy restart
